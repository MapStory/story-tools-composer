<!-- Storypin Controller -->
<div id="pins-editor"
     ng-controller="storypinController"
     class="floating style-editor-item">
    <!-- Bulk upload controller -->
    <div ng-controller="bulkUploadCtrl">
        <!-- Pin Accordion -->
        <uib-accordion close-others="false" ng-init="is_open.editor = false; is_open.chooser = true;">
            <!-- Pin List -->
            <div uib-accordion-group heading="StoryPins" is-open="is_open.chooser">
                <button class="btn btn-inverse" ng-click="onBulkPinAdd()">Bulk Upload</button>
                <button class="btn btn-inverse" ng-click="on_add_storypin()">Add a StoryPin</button>
                <button class="btn btn-inverse" ng-click="on_export_pins()">Export StoryPins</button>
            </div>
        </uib-accordion>
        <!-- THE MODAL -->
        <!-- TODO: Move this to a template -->
        <!-- Change the ID's to something more unique -->
        <script type="text/ng-template" id="myModalContent.html">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Bulk Pin upload</h3>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- TODO: Set download here -->
                <a href="#">Download the template here</a>
                <br />
                <input type="file" name="bulk" accept="text/csv" id="bulk_pin_csv_file">
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>
                <button id="ok-btn-modal-bulk" class="btn btn-primary" type="button" ng-click="processCSVFile()">OK</button>
            </div>
        </script>
    </div>
</div>
<!--STORYPIN LIST-->
<section id="pin-list">
    <uib-accordion close-others=true>
        <!-- Gets pins from pin service-->
        <section ng-repeat="($index,pin) in pinSvc.getPins(stateSvc.getChapterIndex())">
            <!-- A STORYPIN -->
            <div uib-accordion-group class="panel-default storypin-content" is-open="pin.is_open">
                <!-- Heading -->
                <uib-accordion-heading>
                        <span>
                            {{pin.title}}
                            <i ng-class="{'fa-caret-up': pinSvc.activePin === $index,'fa-caret-down': pinSvc.activePin !== $index}" class="fa"></i>
                        </span>
                </uib-accordion-heading>

                <!-- Content -->
                <div id="pin-form-{{$index}}">
                    <!-- Move Button-->
                    <button class="btn btn-inverse" ng-click="pinSvc.turnPinDrawModeOn($index)">
                        {{pinSvc.isDrawing ? "Done" : "Move Pin"}}
                    </button>
                    <!-- Save Button -->
                    <button id="storpin-save-button" class="btn btn-inverse" ng-click="pinSvc.onStoryPinSave()">Update Map</button>
                    <button id="storypin-delete-button" class="btn" ng-click="pinSvc.removePinByIndex($index, stateSvc.getChapterIndex())">Delete</button>
                </div>
                    <!-- Edit Form -->
                    <form>
                        <!-- Title -->
                        <div class="form-field">
                            <label for="storypin_title">StoryPin Title</label>
                            <strong><abbr title="required">*</abbr></strong>
                            <br/>
                            <input id="storypin_title" type="text" name="storypin_title" ng-model="pin.title"/>
                        </div>
                        <!-- Text -->
                        <div class="form-field">
                            <label for="storypin_text">StoryPin Text</label>
                            <strong><abbr title="required">*</abbr></strong>
                            <br/>
                            <input id="storypin_text" type="text" name="storypin_text"
                                   ng-model="pin.content"/>
                        </div>
                        <!-- Media -->
                        <div class="form-field">
                            <label for="storypin_media">StoryPin Media</label>
                            <strong><abbr title="required">*</abbr></strong>
                            <br/>
                            <!-- TODO: Empty text areas don't work in all browsers-->
                            <input id="storypin_media" type="text" name="storypin_media" ng-model="pin.media" required/>
                        </div>
                        <!-- Start Time -->
                        <div class="form-field">
                            <label for="start_time">Start Time</label>
                            <strong><abbr title="required">*</abbr></strong>
                            <div class="input-group">
                                <input id="start_time"
                                       class="form-control"
                                       uib-datepicker-popup="{{pinSvc.format}}"
                                       ng-model="pin.startTime"
                                       is-open="pinSvc.startDatePopup.opened"
                                       datepicker-options="pinSvc.dateOptions"
                                       uib-init-date="false"
                                       init-date="false"
                                       ng-required="true"
                                       close-text="Close"
                                       alt-input-formats="pinSvc.altInputFormats"
                                />
                                <span class="input-group-btn">
                                    <button type="button"
                                            class="btn btn-default"
                                            ng-click="pinSvc.openStartDate()"><i class="glyphicon glyphicon-calendar" aria-label="Open start date"></i>
                                    </button>
                                </span>
                            </div>
                            <!--<div class="row">-->
                                <!--<div uib-timepicker ng-model="pinSvc.pinStartTime" ng-change="pinSvc.onChangedTime()" show-meridian="true"></div>-->
                            <!--</div>-->
                        </div>
                        <!-- End Time -->
                        <div class="form-field">
                            <label for="end_time">End Time</label>
                            <strong><abbr title="required">*</abbr></strong>
                            <div class="input-group">
                                <input id="end_time"
                                    class="form-control"
                                    uib-datepicker-popup="{{pinSvc.format}}"
                                    ng-model="pin.endTime"
                                    is-open="pinSvc.endDatePopup.opened"
                                    datepicker-options="pinSvc.dateOptions"
                                    uib-init-date="false"
                                    init-date="false"
                                    ng-required="true"
                                    close-text="Close"
                                    alt-input-formats="pinSvc.altInputFormats"
                                />
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-default" ng-click="pinSvc.openEndDate()"><i class="glyphicon glyphicon-calendar" aria-label="Open end date"></i></button>
                                </span>
                            </div>
                            <!--<div class="row">-->
                                <!--<div uib-timepicker ng-model="pinSvc.pinEndTime" ng-change="pinSvc.onChangedTime()" show-meridian="true"></div>-->
                            <!--</div>-->
                        </div>
                        <!--<hr>-->
                        <!--&lt;!&ndash; Latitude &ndash;&gt;-->
                        <!--<label for="lat-input">Latitude</label>-->
                        <!--<input id="lat-input" type="number" name="lat" ng-model="pin.mapFeature.getGeometry().getCoordinates()[0]" placeholder="{{pin.coords[0]}}">-->
                        <!--<br/>-->
                        <!--&lt;!&ndash; Longitude &ndash;&gt;-->
                        <!--<label for="long-input">Longitude</label>-->
                        <!--<input id="long-input" type="number" name="long" ng-model="pin.mapFeature.getGeometry().getCoordinates()[1]" placeholder="{{pin.coords[1]}}">-->
                        <!--<hr>-->
                        <!-- TODO: Implement options -->
                        <!-- Playback Options -->
                        <!--<div class="form-field">-->
                            <!--<label for="storypin_playback_options">-->
                                <!--StoryPin Playback Options-->
                            <!--</label>-->
                            <!--<br/>-->
                            <!--&lt;!&ndash; Show in timeline &ndash;&gt;-->
                            <!--<label class="switch">-->
                                <!--<input type="checkbox" for="timeline"-->
                                       <!--ng-init="pin.inTimeline = false"-->
                                       <!--ng-model="pin.inTimeline">-->
                                <!--<div class="slider round"></div>-->
                            <!--</label>-->
                            <!--<label for="timeline">Show StoryPin on Timeline</label>-->
                            <!--<br/>-->
                            <!--&lt;!&ndash; Show on map &ndash;&gt;-->
                            <!--<label class="switch">-->
                                <!--<input type="checkbox" for="map"-->
                                       <!--ng-init="pin.inMap = true"-->
                                       <!--ng-model="pin.inMap">-->
                                <!--<div class="slider round"></div>-->
                            <!--</label>-->
                            <!--<label for="map">Show StoryPin on Map</label>-->
                            <!--<br/>-->
                            <!--&lt;!&ndash; Pause playback &ndash;&gt;-->
                            <!--<label class="switch">-->
                                <!--<input type="checkbox" for="pause_playback">-->
                                <!--<div class="slider round"></div>-->
                            <!--</label>-->
                            <!--<label for="pause_playback">-->
                                <!--Pause playback when StoryPin appears-->
                            <!--</label>-->
                            <!--<br/>-->
                            <!--&lt;!&ndash; autoplay embedded&ndash;&gt;-->
                            <!--<label class="switch">-->
                                <!--<input type="checkbox" for="play_embedded"-->
                                       <!--ng-init="pin.autoShow = false"-->
                                       <!--ng-model="pin.autoShow">-->
                                <!--<div class="slider round"></div>-->
                            <!--</label>-->
                            <!--<label for="play_embedded">-->
                                <!--Play embedded StoryPin media automatically-->
                            <!--</label>-->
                        <!--</div>-->
                    </form>
                </div>
            </div>
        </section>
    </uib-accordion>
</section>
